{% extends "base.html" %}

{% block content %}


<br><br>


<h2>Search Inventory Based On Seller ID:</h2>
  <form action="{{ url_for('inventory.inventory_view') }}" method="POST">
    <label for = "user_id">Seller ID: </label>
    <input type="text"  placeholder="Enter Seller ID..."  name="user_id" user_id = "user_id" />
  </form>

  <h2>See Your Inventory:</h2>
  <form action="{{ url_for('inventory.inv') }}" method="POST">
    <input type="submit" value="Search">
  </form>

  <h2>Register as Seller:</h2>
  <form action="{{ url_for('inventory.inventory_register') }}" method="POST">
    <input type="submit" value="Register">
  </form>

  <h2>Check Orders:</h2>
  <form action="{{ url_for('inventory.inventory_order_fulfill') }}" method="POST">
    <input type="submit" value="Search">
  </form>

<h2>Search User's Cart Items</h2>
<form action="{{ url_for('cart.cart_search') }}" method="POST">
    <label for="user_id">User ID:</label>
    <input type="text" id="user_id" name="user_id">
    <input type="submit" value="Search">
</form>

<h2>Search Users</h2>
<form action="{{ url_for('users.user_search') }}" method="POST">
    <label for="user_id">User ID:</label>
    <input type="text" id="user_id" name="user_id">
    <input type="submit" value="Search">
</form>


<script>
function updateSubtags() {
    var tag = document.getElementById('tag').value;
    var subtagSelect = document.getElementById('subtag');

    // Clear the subtag select element
    subtagSelect.innerHTML = '';

    // Add an "All" option for the selected category
    var allOption = document.createElement('option');
    allOption.value = 'All';
    allOption.text = 'All';
    subtagSelect.appendChild(allOption);

    if (tag !== '') {
        // Fetch and populate subtags based on the selected category
        fetch('/get-subtags?tag=' + tag)
            .then(function(response) {
                return response.json();
            })
            .then(function(data) {
                data.subtags.forEach(function(subtag) {
                    var option = document.createElement('option');
                    option.value = subtag;
                    option.text = subtag;
                    subtagSelect.appendChild(option);
                });
            });
    }
}

</script>


<h2>Search Products</h2>
<form action="/search" method="get">
    <!-- Search Input -->
    <input type="text" name="keyword" placeholder="Search products..." value="">

    <!-- Category Selection -->
    <select name="tag" id="tag" onchange="updateSubtags()">
        <option value="">All Categories</option>
        <option value="Groceries">Groceries</option>
        <option value="Basics">Basics</option>
        <option value="Music">Music</option>
        <option value="Books">Books</option>
        <option value="Tech">Tech</option>
        <option value="Pharmacy">Pharmacy</option>
        <option value="Fashion">Fashion</option>
        <!-- ... other options ... -->
    </select>
    
    <!-- Subcategory Selection -->
    <select name="subtag" id="subtag">
        <option value="">All Subcategories</option>
        <!-- Options will be populated by JavaScript -->
    </select>

    <!-- Sorting Options -->
    <select name="sort_order">
        <option value="asc">Price: Low to High</option>
        <option value="desc">Price: High to Low</option>
    </select>
    
    <button type="submit">Search</button>
</form>



<link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">

<!-- Products for sale (Card Layout) -->
<h2>Products for sale:</h2>
<div class="product-container">
  {% for product in avail_products %}
    <div class="product-card">
      <!-- Use the full URL stored in the photo_url column -->
      <img src="{{ product.photo_url }}" alt="{{product.name}}" class="product-image"/>
      <div class="product-info">
        <h3><a href="/product/{{product.id}}">{{ product.name }}</a></h3>
        <p>Tag: {{ product.tag }}</p>
        <p>Price: {{ product.price }}</p>
        <form action="{{ url_for('wishlist.wishlist_add', product_id=product.id) }}" method="POST">
          <input type="submit" value="Add to Wishlist" class="btn-wishlist"/>
        </form>
        <form action = "{{ url_for('cart.cart_add', product_id=product.id) }}" method="POST">
          <input type="number" id="quantityInput" name="quantityChoice" min="1" max="99" value="1">
          <input type="submit" value="Add to Cart" class = "btn-cart"/>
      </form>
      </div>
    </div>
  {% endfor %}
</div>




<br><br>
{% if current_user.is_authenticated %}
<h2>Your recent purchases:</h2>
<table class='table table-hover table-bordered container'>
  <thead class="thead-dark">
    <tr>
      <th scope="col">Purchase ID</th>
      <th scope="col">Product ID</th>
      <th scope="col">Time Purchased</th>
    </tr>
  </thead>
  <tbody>
    {% for purchase in purchase_history%}
      <tr>
        <th scope="row">{{purchase.id}}</th>
        <td>{{purchase.pid}}<form action="{{ url_for('review.review_add', product_id = purchase.pid) }}" method="POST">
          <input type="submit" value="Review Product"/>
        </form></td>
        <td>{{purchase.time_purchased}}</td>
      </tr>
    {% endfor %}
  </tbody>
</table>
{% else %}
<p><a href="{{ url_for('users.login') }}">Log in</a> to see your purchase history!</p>
{% endif %}
{% endblock %}
