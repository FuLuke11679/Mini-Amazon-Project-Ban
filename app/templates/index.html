{% extends "base.html" %}

{% block content %}

<br><br>

<h2>Search for 5 user feedback based on ID:</h2>
<form action="{{ url_for('review.review') }}" type="submit" method="POST">
   <input type="text" id="searchReviewId" name="searchReviewChoice" placeholder="Input User ID To Get Reviews Here">
</form>

<br>

<h2>Search Inventory Based On Seller ID:</h2>
  <form action="{{ url_for('inventory.inventory_view') }}" method="POST">
    <label for = "user_id">Seller ID: </label>
    <input type="text"  placeholder="Enter Seller ID..."  name="user_id" user_id = "user_id" />
  </form>


<h2>Search User's Cart Items</h2>
<form action="{{ url_for('cart.cart_search') }}" method="POST">
    <label for="user_id">User ID:</label>
    <input type="text" id="user_id" name="user_id">
    <input type="submit" value="Search">
</form>

<h2>Search User Purchases</h2>
<form action="{{ url_for('purchases.purchases_search') }}" method="POST">
    <label for="user_id">User ID:</label>
    <input type="text" id="user_id" name="user_id">
    <input type="submit" value="Search">
</form>

<h2>Search Products</h2>
<form action="/search" method="get">
  <input type="text" name="keyword" placeholder="Search products...">
  <button type="submit">Search</button>
</form>

<form action="{{ url_for('index.index') }}" method="get">
  <select name="sort_order">
      <option value="asc">Price: Low to High</option>
      <option value="desc">Price: High to Low</option>
  </select>
  <input type="submit" value="Sort">
</form>

<script>
  function updateSubtags() {
      var tag = document.getElementById('tag').value;
      fetch('/get-subtags?tag=' + tag)
          .then(function(response) {
              return response.json();
          })
          .then(function(data) {
              var subtagSelect = document.getElementById('subtag');
              subtagSelect.innerHTML = '';
              data.subtags.forEach(function(subtag) {
                  var option = document.createElement('option');
                  option.value = subtag;
                  option.text = subtag;
                  subtagSelect.appendChild(option);
              });
          });
  }
  </script>

<select name="tag" id="tag" onchange="updateSubtags()">
  <option value="">Select a Category</option>
  <option value="Groceries">Groceries</option>
  <option value="Basics">Basics</option>
  <option value="Music">Music</option> <!-- Unique value for Music -->
  <option value="Books">Books</option> <!-- Unique value for Books -->
  <option value="Tech">Tech</option>   <!-- Unique value for Tech -->
  <option value="Pharmacy">Pharmacy</option> <!-- Unique value for Pharmacy -->
  <option value="Fashion">Fashion</option>   <!-- Unique value for Fashion -->
  <!-- ... other options ... -->
</select>

<select name="subtag" id="subtag">
  <option value="">Select a Subcategory</option>
  <!-- Subtag options will be populated here -->
</select>

  

<h2>Products for sale:</h2>
<table class='table table-hover table-bordered container'>
  <thead class="thead-dark">
    <tr>
      <th scope="col">Product ID</th>
      <th scope="col">Product Name</th>
      <th scope="col">Price</th>
      <th scope="col">Save/Add To Cart</th>
    </tr>
  </thead>
  <tbody>

    {% for product in avail_products%}
      <tr>
  

        <th scope="row">{{product.id}}</th>
        <td><a href="/product/{{product.id}}">{{product.name}}</a><form action="{{ url_for('wishlist.wishlist_add', product_id=product.id) }}" method="POST">
            <input type="submit" value="Add to Wishlist"/>
          </form></td>
        <td>{{product.price}}</td>
        <td>
          <form action="{{ url_for('wishlist.wishlist_add', product_id=product.id) }}"
          method="POST">
          <input type="submit" value="Add to Wishlist"/>
          </form>
          <form action="{{ url_for('cart.cart_add', product_id=product.id) }}"
          method="POST">
          <input type="submit" value="Add to Cart"/>
        </td>
      </tr>
    {% endfor %}
  </tbody>
</table>

{% if page > 1 %}
<a href="{{ url_for('index.index', page=page-1) }}">Previous</a>
{% endif %}

{% if avail_products|length == 10 %}
<a href="{{ url_for('index.index', page=page+1) }}">Next</a>
{% endif %}



<br><br>
{% if current_user.is_authenticated %}
<h2>Your most recent purchases:</h2>
<table class='table table-hover table-bordered container'>
  <thead class="thead-dark">
    <tr>
      <th scope="col">Purchase ID</th>
      <th scope="col">Product Id</th>
      <th scope="col">Time Purchased</th>
    </tr>
  </thead>
  <tbody>
    {% for purchase in recent_purchase_history%}
      <tr>
        <th scope="row">{{purchase.id}}</th>
        <td>{{purchase.pid}}<form action="{{ url_for('review.review_add', product_id = purchase.pid) }}" method="POST">
          <input type="submit" value="Review Product"/>
        </form></td>
        <td>{{purchase.time_purchased}}</td>
      </tr>
    {% endfor %}
  </tbody>
</table>
{% else %}
<p><a href="{{ url_for('users.login') }}">Log in</a> to see your purchase history!</p>
{% endif %}
{% endblock %}
