{% extends "base.html" %}
{% block content %}

<!DOCTYPE html>
<html lang="en">
<head>
    <!-- head elements -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
</head>
<body>

    <script>
        function updateSubtags() {
            var tag = document.getElementById('tag').value;
            var subtagSelect = document.getElementById('subtag');
            var currentSubtag = '{{ subtag }}'; // Get the current subtag from the Flask template

            // Clear the subtag select element
            subtagSelect.innerHTML = '';

            // Add an "All" option for the selected category
            var allOption = document.createElement('option');
            allOption.value = '';
            allOption.text = 'All Subcategories';
            subtagSelect.appendChild(allOption);

            if (tag !== '') {
                // Fetch and populate subtags based on the selected category
                fetch('/get-subtags?tag=' + tag)
                    .then(function(response) {
                        return response.json();
                    })
                    .then(function(data) {
                        data.subtags.forEach(function(subtag) {
                            var option = document.createElement('option');
                            option.value = subtag;
                            option.text = subtag;
                            if (subtag === currentSubtag) {
                                option.selected = true;
                            }
                            subtagSelect.appendChild(option);
                        });
                    });
            }
        }

        // Call the function to update subtags on page load
        document.addEventListener('DOMContentLoaded', function() {
            updateSubtags();
        }, false);
    </script>

    <!-- Start of the modified search bar in search_results.html -->
<!-- Search Container -->
<div class="search-container">
    <h2>Search Products</h2>
  
    <!-- Search Bar and Button -->
    <div class="search-bar-container">
        <form action="/search" method="get" class="search-form">
            <input type="text" name="keyword" placeholder="Search products..." class="search-input">
            <button type="submit" class="search-button">Search</button>
        </form>
    </div>
  
    <!-- Dropdown Search Options -->
    <div class="search-options">
        <select name="tag" id="tag" onchange="updateSubtags()" class="search-select">
            <option value="">All Categories</option>
            <option value="Groceries">Groceries</option>
            <option value="Basics">Basics</option>
            <option value="Music">Music</option>
            <option value="Books">Books</option>
            <option value="Tech">Tech</option>
            <option value="Pharmacy">Pharmacy</option>
            <option value="Fashion">Fashion</option>
            <!-- ... other options ... -->
        </select>
  
        <select name="subtag" id="subtag" class="search-select">
            <option value="">All Subcategories</option>
            <!-- Subcategories options will be populated by JavaScript -->
        </select>
  
        <select name="sort_order" class="search-select">
            <option value="asc">Price: Low to High</option>
            <option value="desc">Price: High to Low</option>
        </select>
    </div>
  </div>

  <div class="search-details">
    <strong>Currently Searching For:</strong> 
    {% if search_term %}{{ search_term }}{% else %}Any Keyword{% endif %}
    <strong>| Browsing:</strong> 
    {% if tag %}{{ tag }}{% else %}All Categories{% endif %}
    <strong>| Browsing:</strong> 
    {% if subtag %}{{ subtag }}{% else %}All Subcategories{% endif %}
</div>
    
    <!-- Displaying products in a table similar to index.html -->
    {% if products %}
    <div class="product-container">
        {% for product in products %}
        <div class="product-card">
            <img src="{{ product.photo_url }}" alt="{{ product.name }}" class="product-image"/>
            <div class="product-info">
                <h3><a href="/product/{{ product.id }}">{{ product.name }}</a></h3>
                <p>Price: ${{ product.price }}</p>
                <form action="{{ url_for('wishlist.wishlist_add', product_id=product.id) }}" method="POST">
                    <input type="submit" value="Add to Wishlist" class="btn-wishlist"/>
                </form>
                <form action="{{ url_for('cart.cart_add', product_id=product.id) }}" method="POST">
                    <input type="submit" value="Add to Cart" class="btn-cart"/>
                </form>
            </div>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <p>No products found matching your criteria.</p>
    {% endif %}


    <!-- Link to CSS file -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">

</body>
</html>

{% endblock %}